# Vulnerability schemas
from pydantic import BaseModel, Field, ConfigDict
from typing import Optional
from datetime import datetime
from enum import Enum
import uuid

class VulnerabilitySeverity(str, Enum):
    CRITICAL = 'critical'
    HIGH = 'high'
    MEDIUM = 'medium'
    LOW = 'low'
    INFO = 'info'

class Vulnerability(BaseModel):
    model_config = ConfigDict(extra='ignore')
    
    id: str = Field(default_factory=lambda: str(uuid.uuid4()))
    repository_id: str
    type: str  # SQL Injection, XSS, etc.
    severity: VulnerabilitySeverity
    title: str
    description: str
    cwe_id: str
    file_path: str
    line_number: Optional[int] = None
    code_snippet: Optional[str] = None
    ai_confidence: float = 0.0  # 0-1
    ai_reasoning: Optional[str] = None
    status: str = 'open'  # open, fixed, ignored
    remediation: Optional[str] = None
    created_at: datetime = Field(default_factory=lambda: datetime.now())

class VulnerabilityCreate(BaseModel):
    repository_id: str
    type: str
    severity: VulnerabilitySeverity
    title: str
    description: str
    cwe_id: str
    file_path: str
    line_number: Optional[int] = None
    code_snippet: Optional[str] = None
    ai_confidence: float = 0.0
    ai_reasoning: Optional[str] = None
